<!-- ==========================================================================
  ðŸŒŒ VOID ENERGY: HYDRATION SCRIPT (Anti-FOUC)
  ==========================================================================
  
  PURPOSE:
  This critical script runs synchronously before the First Contentful Paint.
  It reads `localStorage` and applies the user's active Atmosphere, Font,
  and Scale immediately to the <html> root.

  WHY IS THIS NEEDED?
  Without this, the UI would render in the default 'void' theme for a split
  second before the JavaScript bundle loads, causing a jarring "Flash of 
  Unstyled Content" (FOUC) or "Flash of Wrong Theme".

  MECHANISM:
  1. Blocking Execution: `is:inline` ensures this runs immediately.
  2. DOM Manipulation: Sets `data-atmosphere` and CSS Variables.
  3. Handoff: Once loaded, `void-engine.ts` takes over state management.
  ========================================================================== -->

<script is:inline>
  (function () {
    try {
      const root = document.documentElement;
      const store = localStorage;

      // 1. Restore Atmosphere
      const savedAtmosphere = store.getItem('void_atmosphere');
      const theme = savedAtmosphere || 'void';
      root.setAttribute('data-atmosphere', theme);

      // 2. Restore Font Override
      const savedFont = store.getItem('void_user_font');
      if (savedFont && savedFont !== 'default') {
        root.style.setProperty('--user-font-body', savedFont);
      }

      // 3. Restore Text Scale
      const savedScale = store.getItem('void_text_scale');
      if (savedScale) {
        root.style.setProperty('--text-scale', savedScale);
      }
    } catch (e) {
      console.warn('Void Energy: Hydration failed', e);
    }
  })();
</script>
