/*
 * ROLE: Typography scale and semantic mixins.
 * RESPONSIBILITY: Defines clamps, weights, and semantic helpers that adapt to Atmosphere fonts and Triad scaling.
 */

@use 'sass:map';
@use '../abstracts' as *;
@use '../components/anchors';

/* =========================================
   1. THE LOGIC (Scales & Weights)
   ========================================= */

// Size logic validated for responsive readability.
$font-scale: (
  // Mobile: 14px (0.875rem) -> Desktop: 18px (1.125rem)
  'body': clamp(0.875rem, 0.8rem + 0.5vw, 1.125rem),
  // Mobile: 12px -> Desktop: 16px
  'small': clamp(0.75rem, 0.7rem + 0.3vw, 1rem),
  // Mobile: 11px -> Desktop: 14px
  'caption': clamp(0.6875rem, 0.65rem + 0.25vw, 0.875rem),
  // Mobile: 32px -> Desktop: 56px (High Contrast Hero)
  'h1': clamp(2rem, 1.5rem + 3vw, 3.5rem),
  // Mobile: 24px -> Desktop: 40px
  'h2': clamp(1.5rem, 1.25rem + 2vw, 2.5rem),
  // Mobile: 20px -> Desktop: 32px
  'h3': clamp(1.25rem, 1.1rem + 1.5vw, 2rem),
  // Mobile: 18px -> Desktop: 24px
  'h4': clamp(1.125rem, 1rem + 1vw, 1.5rem),
  // Mobile: 16px -> Desktop: 20px
  'h5': clamp(1rem, 0.95rem + 0.5vw, 1.25rem)
);

// Weight Logic (Graduated hierarchy)
$font-weights: (
  // Structural (Bold)
  'h1': 700,
  // Structural (Bold)
  'h2': 700,
  // Section (SemiBold)
  'h3': 600,
  // Subsection (SemiBold)
  'h4': 600,
  // Card Title (Medium)
  'h5': 500,
  'body': 400,
  // Input data should be legible (Regular)
  'input': 400
);

// Line Height Logic (Optimized for each typographic
// Based on Apple's SF Pro standard: 1.2 for headlines, 1.5 for body.
$line-heights: (
  'h1': 1.1,
  'h2': 1.15,
  'h3': 1.2,
  'h4': 1.3,
  'h5': 1.4,
  'body': 1.5,
  'small': 1.5,
  'caption': 1.4,
);

/* =========================================
   1.5. EMIT CSS VARIABLES (Runtime Scaling)
   ========================================= */
// Generate CSS variables for typography tokens to enable runtime scaling
:root {
  // Font Sizes (Dynamic)
  --font-size-h1: #{map.get($font-scale, 'h1')};
  --font-size-h2: #{map.get($font-scale, 'h2')};
  --font-size-h3: #{map.get($font-scale, 'h3')};
  --font-size-h4: #{map.get($font-scale, 'h4')};
  --font-size-h5: #{map.get($font-scale, 'h5')};
  --font-size-body: #{map.get($font-scale, 'body')};
  --font-size-small: #{map.get($font-scale, 'small')};
  --font-size-caption: #{map.get($font-scale, 'caption')};

  // Line Heights (Semantic)
  --line-height-heading: #{map.get($line-heights, 'h1')};
  --line-height-heading-h2: #{map.get($line-heights, 'h2')};
  --line-height-heading-h3: #{map.get($line-heights, 'h3')};
  --line-height-subheading: #{map.get($line-heights, 'h4')};
  --line-height-title: #{map.get($line-heights, 'h5')};
  --line-height-body: #{map.get($line-heights, 'body')};
  --line-height-small: #{map.get($line-heights, 'small')};
  --line-height-caption: #{map.get($line-heights, 'caption')};

  // Font Weights (Semantic)
  --font-weight-bold: #{map.get($font-weights, 'h1')};
  --font-weight-semibold: #{map.get($font-weights, 'h3')};
  --font-weight-medium: #{map.get($font-weights, 'h5')};
  --font-weight-regular: #{map.get($font-weights, 'body')};
}

/* =========================================
   2. THE MIXIN
   ========================================= */
@mixin typography($level: 'body', $is-input: false) {
  @if map.has-key($font-scale, $level) {
    // 1. FAMILY & WEIGHT ASSIGNMENT
    // -----------------------------
    @if (
      $level ==
        'h1' or
        $level ==
        'h2' or
        $level ==
        'h3' or
        $level ==
        'h4' or
        $level ==
        'h5'
    ) {
      font-family: var(--font-heading);
      font-weight: map.get($font-weights, $level);
    } @else {
      font-family: var(--font-body);

      @if $is-input {
        font-weight: map.get($font-weights, 'input');
      } @else {
        font-weight: map.get($font-weights, 'body');
      }
    }

    // 2. SIZE CALCULATION
    // -----------------------------
    $base-clamp: map.get($font-scale, $level);

    // Clamp scales with --text-scale while capping growth on ultra-wide viewports.
    font-size: calc(#{$base-clamp} * var(--text-scale));
    line-height: map.get($line-heights, $level);

    // 3. RESPONSIVE OVERRIDES
    // -----------------------------

    // Tablet Override for H1 to preserve hero hierarchy on larger canvases.
    @if $level == 'h1' {
      @include respond-up(tablet) {
        font-size: calc(clamp(2rem, 5vw, 3.5rem) * var(--text-scale));
      }
    }
  } @else {
    @warn "Typography level `#{$level}` not found in scale.";
  }
}

/* =========================================
   3. GLOBAL ELEMENTS (Void Semantics)
   ========================================= */

body {
  // Use the active atmosphere family while honoring user overrides.
  font-family: var(--font-body);

  // Applies the scale factor
  font-size: calc(1rem * var(--text-scale));
}

h1,
h2,
h3 {
  // Headings stay tied to the atmosphere family for identity.
  font-family: var(--font-heading);
}

/* Layer 1: Headers (100% Opacity) */
h1 {
  @include typography('h1');
  color: var(--text-main);
}
h2 {
  @include typography('h2');
  color: var(--text-main);
}
h3 {
  @include typography('h3');
  color: var(--text-main);
}

/* Layer 2: Subheaders/Body (85% Opacity) */
h4 {
  @include typography('h4');
  color: var(--text-dim);
} // H4 often acts as subheader
h5 {
  @include typography('h5');
  color: var(--text-dim);
}

p,
ul,
ol,
li,
label,
button {
  @include typography('body');
  color: var(--text-dim);
}

/* Layer 3: Metadata (60% Opacity) */
caption,
small {
  @include typography('small');
  color: var(--text-mute);
}

/* INPUTS (Special Case) */
/* Inputs share H5 size but need 'input' weight (Regular) and bright text for data */
input,
select,
textarea {
  @include typography('h5', $is-input: true); // Pass flag to force weight: 400
  // Input data is treated as active signal, so it uses main text color.
  color: var(--text-main);
}

/* =========================================
   4. UTILITY CLASSES
   ========================================= */
.text-caption {
  @include typography('caption');
}
.text-small {
  @include typography('small');
}
.text-body {
  @include typography('body');
}
.text-h1 {
  @include typography('h1');
}
.text-h2 {
  @include typography('h2');
}
.text-h3 {
  @include typography('h3');
}
.text-h4 {
  @include typography('h4');
}
.text-h5 {
  @include typography('h5');
}

// SINGLE LINE (Headings / Usernames)
.text-truncate {
  @include text-truncate(1);
}

// MULTI LINE (Narrative Descriptions)
.text-clamp-2 {
  @include text-truncate(2);
}
.text-clamp-3 {
  @include text-truncate(3);
}

// BREAK WORDS (For User Content / Logs)
.text-break {
  @include text-wrap-force;
}

/* =========================================
   5. LONG-FORM CONTENT (Legal / Docs)
   ========================================= */
// Usage: Wrap your Markdown or Legal Text in <div class="legal-content">
// This re-enables lists ONLY inside this wrapper.

.legal-content {
  color: var(--text-dim); // Ensure readable contrast

  // 1. RE-ENABLE STANDARD LISTS
  ul,
  ol {
    margin-bottom: var(--space-md);
    padding-left: var(--space-md);
  }

  ul {
    list-style-type: disc;
  }
  ol {
    list-style-type: decimal;
  }

  // Nested list support
  ul ul {
    list-style-type: circle;
    margin-bottom: 0;
  }
  ul ul ul {
    list-style-type: square;
  }

  // 2. UTILITY LIST STYLES
  ol.uppercase {
    list-style-type: upper-alpha;
  }
  ol.lowercase {
    list-style-type: lower-alpha;
  }

  // 3. LEGAL SUB-ORDERED (1.1, 1.2)
  // Provides contract-style numbering without browser bullet defaults.
  ol.subordered {
    list-style-type: none;
    counter-reset: item;
    padding-left: 0; // Legal numbering typically aligns flush-left

    & > li {
      display: table;
      counter-increment: item;
      margin-bottom: var(--space-xs);

      &:before {
        content: counters(item, '.') '. ';
        display: table-cell;
        padding-right: var(--space-sm);
        color: var(--text-main); // Bright numbering distinguishes hierarchy
        font-weight: 600;
        white-space: nowrap;
      }
    }

    // Recursive nesting support
    li ol.subordered > li:before {
      content: counters(item, '.') ' ';
    }
  }

  // 4. TYPOGRAPHY FIXES
  // Legal docs need clear distinction between emphasis and headings.
  strong,
  b {
    color: var(--text-main); // Highlight key terms (e.g., "SECTION 1")
    font-weight: var(--font-weight-bold);
  }

  a {
    @extend .link; // Apply system link styling for consistent emphasis
  }
}
