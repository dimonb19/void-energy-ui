/* Typography scale and semantic mixins. */

@use 'sass:map';
@use '../abstracts' as *;
@use '../config/generated-themes' as generated;
@use '../components/anchors';

// Typography maps (generated from design-tokens.ts).
$font-scale: generated.$font-scale;
$font-weights: generated.$font-weights;
$line-heights: generated.$line-heights;
$letter-spacings: generated.$letter-spacings;

/* Emit CSS variables for runtime scaling. */
:root {
  // Font sizes.
  --font-size-h1: #{map.get($font-scale, 'h1')};
  --font-size-h2: #{map.get($font-scale, 'h2')};
  --font-size-h3: #{map.get($font-scale, 'h3')};
  --font-size-h4: #{map.get($font-scale, 'h4')};
  --font-size-h5: #{map.get($font-scale, 'h5')};
  --font-size-body: #{map.get($font-scale, 'body')};
  --font-size-small: #{map.get($font-scale, 'small')};
  --font-size-caption: #{map.get($font-scale, 'caption')};

  // Line heights.
  --line-height-heading: #{map.get($line-heights, 'h1')};
  --line-height-heading-h2: #{map.get($line-heights, 'h2')};
  --line-height-heading-h3: #{map.get($line-heights, 'h3')};
  --line-height-subheading: #{map.get($line-heights, 'h4')};
  --line-height-title: #{map.get($line-heights, 'h5')};
  --line-height-body: #{map.get($line-heights, 'body')};
  --line-height-small: #{map.get($line-heights, 'small')};
  --line-height-caption: #{map.get($line-heights, 'caption')};

  // Font weights.
  --font-weight-bold: #{map.get($font-weights, 'h1')};
  --font-weight-semibold: #{map.get($font-weights, 'h3')};
  --font-weight-medium: #{map.get($font-weights, 'h5')};
  --font-weight-regular: #{map.get($font-weights, 'body')};

  // Letter-spacing (optical tracking).
  --letter-spacing-h1: #{map.get($letter-spacings, 'h1')};
  --letter-spacing-h2: #{map.get($letter-spacings, 'h2')};
  --letter-spacing-h3: #{map.get($letter-spacings, 'h3')};
  --letter-spacing-h4: #{map.get($letter-spacings, 'h4')};
  --letter-spacing-h5: #{map.get($letter-spacings, 'h5')};
  --letter-spacing-body: #{map.get($letter-spacings, 'body')};
  --letter-spacing-small: #{map.get($letter-spacings, 'small')};
  --letter-spacing-caption: #{map.get($letter-spacings, 'caption')};
}

/* Typography mixin. */
@mixin typography($level: 'body', $is-input: false) {
  @if map.has-key($font-scale, $level) {
    // Headings use heading font; body uses body font with optional input weight.
    @if (
      $level ==
        'h1' or
        $level ==
        'h2' or
        $level ==
        'h3' or
        $level ==
        'h4' or
        $level ==
        'h5'
    ) {
      font-family: var(--font-heading);
      font-weight: map.get($font-weights, $level);
    } @else {
      font-family: var(--font-body);

      @if $is-input {
        font-weight: map.get($font-weights, 'input');
      } @else {
        font-weight: map.get($font-weights, 'body');
      }
    }

    $base-clamp: map.get($font-scale, $level);

    // Scale with --text-scale while keeping the clamp bounds.
    font-size: calc(#{$base-clamp} * var(--text-scale));
    line-height: map.get($line-heights, $level);
    letter-spacing: map.get($letter-spacings, $level);

    // Tablet override to preserve H1 hierarchy.
    @if $level == 'h1' {
      @include respond-up(tablet) {
        font-size: calc(clamp(2rem, 5vw, 3.5rem) * var(--text-scale));
      }
    }
  } @else {
    @warn "Typography level `#{$level}` not found in scale.";
  }
}

/* Global elements. */

body {
  font-family: var(--font-body);

  font-size: calc(1rem * var(--text-scale));
}

h1,
h2,
h3 {
  font-family: var(--font-heading);
  font-kerning: normal;
  font-variant-ligatures: common-ligatures;
  text-rendering: optimizeLegibility;
}

/* Layer 1: headers (100% opacity). */
h1 {
  @include typography('h1');
  color: var(--text-main);
}
h2 {
  @include typography('h2');
  color: var(--text-main);
}
h3 {
  @include typography('h3');
  color: var(--text-main);
}

/* Layer 2: subheaders/body (85% opacity). */
h4 {
  @include typography('h4');
  color: var(--text-dim);
} // H4 often acts as subheader.
h5 {
  @include typography('h5');
  color: var(--text-dim);
}

p,
ul,
ol,
li,
label,
button {
  @include typography('body');
  color: var(--text-dim);
}

/* Layer 3: metadata (60% opacity). */
caption,
small {
  @include typography('small');
  color: var(--text-mute);
}

/* Inputs: H5 size with input weight and active text color. */
input,
select,
textarea {
  @include typography('h5', $is-input: true); // Pass flag to force weight: 400
  color: var(--text-main);
}

/* Utility classes. */
.text-caption {
  @include typography('caption');
}
.text-small {
  @include typography('small');
}
.text-body {
  @include typography('body');
}
.text-h1 {
  @include typography('h1');
}
.text-h2 {
  @include typography('h2');
}
.text-h3 {
  @include typography('h3');
}
.text-h4 {
  @include typography('h4');
}
.text-h5 {
  @include typography('h5');
}

// SINGLE LINE (Headings / Usernames)
.text-truncate {
  @include text-truncate(1);
}

// MULTI LINE (Narrative Descriptions)
.text-clamp-2 {
  @include text-truncate(2);
}
.text-clamp-3 {
  @include text-truncate(3);
}

// BREAK WORDS (For User Content / Logs)
.text-break {
  @include text-wrap-force;
}

/* =========================================
   5. LONG-FORM CONTENT (Legal / Docs)
   ========================================= */
// Usage: Wrap your Markdown or Legal Text in <div class="legal-content">
// This re-enables lists ONLY inside this wrapper.

.legal-content {
  color: var(--text-dim); // Ensure readable contrast

  // 1. RE-ENABLE STANDARD LISTS
  ul,
  ol {
    margin-bottom: var(--space-md);
    padding-left: var(--space-md);
  }

  ul {
    list-style-type: disc;
  }
  ol {
    list-style-type: decimal;
  }

  // Nested list support
  ul ul {
    list-style-type: circle;
    margin-bottom: 0;
  }
  ul ul ul {
    list-style-type: square;
  }

  // 2. UTILITY LIST STYLES
  ol.uppercase {
    list-style-type: upper-alpha;
  }
  ol.lowercase {
    list-style-type: lower-alpha;
  }

  // 3. LEGAL SUB-ORDERED (1.1, 1.2)
  // Provides contract-style numbering without browser bullet defaults.
  ol.subordered {
    list-style-type: none;
    counter-reset: item;
    padding-left: 0; // Legal numbering typically aligns flush-left

    & > li {
      display: table;
      counter-increment: item;
      margin-bottom: var(--space-xs);

      &:before {
        content: counters(item, '.') '. ';
        display: table-cell;
        padding-right: var(--space-sm);
        color: var(--text-main); // Bright numbering distinguishes hierarchy
        font-weight: 600;
        white-space: nowrap;
      }
    }

    // Recursive nesting support
    li ol.subordered > li:before {
      content: counters(item, '.') ' ';
    }
  }

  // 4. TYPOGRAPHY FIXES
  // Legal docs need clear distinction between emphasis and headings.
  strong,
  b {
    color: var(--text-main); // Highlight key terms (e.g., "SECTION 1")
    font-weight: var(--font-weight-bold);
  }

  a {
    @extend .link; // Apply system link styling for consistent emphasis
  }
}
