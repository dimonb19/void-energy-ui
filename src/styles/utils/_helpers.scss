/*
 * ROLE: Utility class generator (Optimized).
 * RESPONSIBILITY: Generates utility classes with a "Split Strategy" to reduce CSS bloat.
 * - Static: Spacing, Colors, Radius (Base breakpoint only).
 * - Responsive: Layout, Flex, Grid, Sizing (All breakpoints).
 */

@use '../abstracts' as *;
@use '../abstracts/variables' as *;
@use 'animations' as *;
@use 'sass:string';
@use 'sass:map';

// ==========================================================================
// 1. CONFIGURATION MAPS
// ==========================================================================

$spacing-directions: (
  '': 'padding',
  'x': 'padding-inline',
  'y': 'padding-block',
  't': 'padding-top',
  'b': 'padding-bottom',
  'l': 'padding-left',
  'r': 'padding-right',
);

$margin-directions: (
  '': 'margin',
  'x': 'margin-inline',
  'y': 'margin-block',
  't': 'margin-top',
  'b': 'margin-bottom',
  'l': 'margin-left',
  'r': 'margin-right',
);

// Layout Maps (Keep these responsive)
$display-map: (
  'hidden': none,
  'block': block,
  'inline-block': inline-block,
  'flex': flex,
  'grid': grid,
  'contents': contents,
);
$flex-dir-map: (
  'flex-row': row,
  'flex-col': column,
  'flex-wrap': wrap,
  'flex-nowrap': nowrap,
);
$align-map: (
  'items-start': flex-start,
  'items-center': center,
  'items-end': flex-end,
  'items-stretch': stretch,
  'justify-start': flex-start,
  'justify-center': center,
  'justify-end': flex-end,
  'justify-between': space-between,
);
$size-map: (
  'w-full': 100%,
  'w-auto': auto,
  'w-screen': 100vw,
  'h-full': 100%,
  'h-auto': auto,
  'h-screen': 100dvh,
  'min-h-screen': 100dvh,
  'max-w-full': 100%,
);

// Spacing Keys (Match _reset.scss)
$space-keys: 'xs', 'sm', 'md', 'lg', 'xl', '2xl';

// ==========================================================================
// 2. GENERATOR: STATIC UTILITIES (Run Once)
// ==========================================================================
// Rationale: Spacing scales via CSS Variables (--density), not class swapping.
@mixin generate-static-utilities {
  // A. SPACING (Padding/Margin/Gap)
  @each $key in $space-keys {
    $val: var(--space-#{$key});

    // Padding
    @each $suffix, $prop in $spacing-directions {
      .p#{$suffix}-#{$key} {
        #{$prop}: $val;
      }
    }
    .p-0 {
      padding: 0;
    }

    // Margin
    @each $suffix, $prop in $margin-directions {
      .m#{$suffix}-#{$key} {
        #{$prop}: $val;
      }
    }
    .m-0 {
      margin: 0;
    }

    // Gap
    .gap-#{$key} {
      gap: $val;
    }
  }

  // Auto Margins
  .mx-auto {
    margin-inline: auto;
  }
  .my-auto {
    margin-block: auto;
  }

  // B. COSMETICS (Radius, Text, Colors)
  @each $name, $value in $radius-scale {
    .rounded-#{$name} {
      border-radius: var(--radius-#{$name});
    }
  }
  .rounded-none {
    border-radius: 0;
  }
  .rounded {
    border-radius: var(--radius-md);
  }

  .text-center {
    text-align: center;
  }
  .text-left {
    text-align: left;
  }
  .text-right {
    text-align: right;
  }
  .text-uppercase {
    text-transform: uppercase;
  }
  .text-capitalize {
    text-transform: capitalize;
  }

  // Semantic Colors
  .text-main {
    color: var(--text-main);
  }
  .text-dim {
    color: var(--text-dim);
  }
  .text-mute {
    color: var(--text-mute);
  } // Fixed typo from 'muted'
  .text-highlight {
    @include text-glow;
    font-weight: 600;
  }
  .text-success {
    color: var(--color-success);
  }
  .text-error {
    color: var(--color-error);
  }
  .text-premium {
    color: var(--color-premium);
  }
  .text-system {
    color: var(--color-system);
  }

  // Physics Effects
  .backdrop-blur-physics {
    backdrop-filter: blur(var(--physics-blur));
    -webkit-backdrop-filter: blur(var(--physics-blur));
  }

  .sr-only {
    position: absolute;
    width: 1px;
    height: 1px;
    padding: 0;
    margin: -1px;
    overflow: hidden;
    clip: rect(0, 0, 0, 0);
    white-space: nowrap;
    border: 0;
  }
}

// ==========================================================================
// 3. GENERATOR: RESPONSIVE UTILITIES (Run Loop)
// ==========================================================================
// Rationale: Layout changes frequently across breakpoints (Stacking -> Flex).
@mixin generate-layout-utilities($prefix: '') {
  // Display
  @each $class, $value in $display-map {
    .#{$prefix}#{$class} {
      display: $value;
    }
  }

  // Flex Direction & Wrap
  @each $class, $value in $flex-dir-map {
    .#{$prefix}#{$class} {
      @if $value == wrap or $value == nowrap {
        flex-wrap: $value;
      } @else {
        flex-direction: $value;
      }
    }
  }

  // Alignment (Items & Justify)
  @each $class, $value in $align-map {
    .#{$prefix}#{$class} {
      @if string.index($class, 'items') {
        align-items: $value;
      } @else {
        justify-content: $value;
      }
    }
  }

  // Grid / Flex Children
  .#{$prefix}flex-1 {
    flex: 1 1 0%;
  }
  .#{$prefix}flex-none {
    flex: none;
  }
  .#{$prefix}grid-cols-1 {
    grid-template-columns: repeat(1, minmax(0, 1fr));
  }
  .#{$prefix}grid-cols-2 {
    grid-template-columns: repeat(2, minmax(0, 1fr));
  }

  // Sizing (Width/Height)
  @each $class, $value in $size-map {
    .#{$prefix}#{$class} {
      @if string.slice($class, 1, 1) == 'w' or string.index($class, 'max-w') {
        width: $value;
      } @else {
        height: $value;
      }
    }
  }
}

// ==========================================================================
// 4. EXECUTION
// ==========================================================================

// 1. Generate Static Utilities (Once)
@include generate-static-utilities;

// 2. Generate Layout Utilities (Base)
@include generate-layout-utilities('');

// 3. Generate Layout Utilities (Responsive Loop)
@each $bp, $value in $breakpoints {
  @if $value != 0 {
    @include respond-up($bp) {
      @include generate-layout-utilities('#{$bp}\\:');
    }
  }
}

// ==========================================================================
// 5. ANIMATION HELPERS (Static)
// ==========================================================================
.fade-in {
  @include entry-transition;
}
.shimmer {
  @include shimmer;
}
.cyber-pulse {
  animation: cyber-pulse 3s var(--ease-pulse) infinite;
}
.loading-logo {
  width: 8rem;
  aspect-ratio: 1/1;
  animation: logo-enter 1.2s var(--ease-snap) forwards;
}
.progress-bar {
  width: 100%;
  height: 4px;
  background: var(--bg-sink);
  border-radius: 2px;
  overflow: hidden;
  span {
    display: block;
    height: 100%;
    background: linear-gradient(
      135deg,
      var(--energy-primary),
      var(--energy-secondary)
    );
    box-shadow: 0 0 10px alpha(var(--energy-primary), 60%);
    border-radius: inherit;
    animation: progress-fill 2s ease-out forwards;
  }
}
.icon {
  width: 1.25em;
  height: 1.25em;
  min-width: 1.25em;
  display: inline-block;
  vertical-align: middle;
  color: inherit;
  transition: transform var(--speed-fast) var(--ease-snap);
}
.icon-sm {
  width: 1em;
  height: 1em;
  min-width: 1em;
}
.icon-lg {
  width: 1.5em;
  height: 1.5em;
  min-width: 1.5em;
}
.icon-xl {
  width: 2em;
  height: 2em;
  min-width: 2em;
}
.icon-spin {
  animation: rotate-laser 2s linear infinite;
}
