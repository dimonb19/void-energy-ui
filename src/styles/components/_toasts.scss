/*
 * ROLE: Toast Notification Physics
 * RESPONSIBILITY: Minimalist Text Capsules with Micro-Indicators
 */

@use '../abstracts' as *;
@use 'buttons';

// ==========================================================================
// 1. REGION & LAYOUT
// ==========================================================================
.toast-region {
  position: fixed;
  top: var(--space-md);
  left: 50%;
  transform: translateX(-50%);

  display: flex;
  flex-direction: column-reverse; // Newest at bottom visually
  align-items: center;
  gap: var(--space-xs);
  pointer-events: none;

  width: 100%;
  max-width: calc(100vw - var(--space-lg));

  /* =========================================
     POPOVER API RESETS (The Void Fix)
     ========================================= */
  &[popover] {
    // 1. Reset UA Geometry
    margin: 0; // Popovers default to 'auto' (centered)
    inset: unset; // Remove default 'inset: 0'
    border: none;
    padding: 0;

    // 2. Reset UA Canvas
    background: transparent; // Popovers default to 'canvas' (white/black)
    color: inherit;

    // 3. Restore Positioning
    // We must re-declare fixed positioning because the UA stylesheet
    // forces it, but we want to ensure our specific top/left vars win.
    position: fixed;
    top: var(--space-md);
    left: 50%;
    transform: translateX(-50%);

    // 4. Overflow Safety
    // Popovers can clip content. We need visible for the glows/shadows.
    overflow: visible;
  }
}

// ==========================================================================
// 2. THE CAPSULE (Surface)
// ==========================================================================
.toast-message {
  @extend .btn-void; // Base button reset

  // --- A. Physics (Glass Capsule) ---
  @include glass-float;
  pointer-events: auto;

  // Layout
  display: flex;
  align-items: center;
  justify-content: center;
  gap: var(--space-xs);

  // Padding: Slightly less on the left because the icon adds visual weight
  padding-block: var(--space-xs);
  padding-right: var(--space-sm);
  padding-left: calc(var(--space-sm) * 0.8);

  border-radius: var(--radius-full);

  // --- B. Semantic Mapping ---
  // Maps notification types to system colors
  --toast-accent: var(--color-system);
  &[data-type='success'] {
    --toast-accent: var(--color-success);
  }
  &[data-type='error'] {
    --toast-accent: var(--color-error);
  }
  &[data-type='warning'] {
    --toast-accent: var(--color-premium);
  }
  &[data-type='loading'] {
    --toast-accent: var(--text-mute);
  }

  // --- C. The Holographic Glow ---
  // Subtle border and ambient glow based on the accent color
  border: var(--physics-border-width) solid alpha(var(--toast-accent), 25%);
  // Tint the glass slightly with the accent color
  background: blend(var(--bg-surface), var(--toast-accent), 15%);

  // Motion
  transition:
    border-color var(--speed-fast) var(--ease-snap),
    box-shadow var(--speed-fast) var(--ease-snap),
    background-color var(--speed-fast) var(--ease-flow);

  // Hover Effect: Lift & Brighten
  &:hover {
    border-color: alpha(var(--toast-accent), 50%);
    box-shadow: var(--shadow-lift);

    @at-root [data-physics='glass'] & {
      box-shadow:
        var(--shadow-lift),
        0 0 15px -4px alpha(var(--toast-accent), 60%);
    }
  }

  // --- D. PHYSICS OVERRIDES ---

  // 1. RETRO (Terminal)
  @at-root [data-physics='retro'] & {
    &[data-type='loading'] {
      --toast-accent: var(--text-main);
    }

    background: blend(var(--bg-canvas), var(--toast-accent), 10%);
    border: var(--physics-border-width) solid var(--toast-accent);

    &:hover {
      background: blend(var(--bg-canvas), var(--toast-accent), 15%);
    }
  }

  // 2. FLAT (Paper/Light)
  @at-root [data-mode='light'] & {
    background: blend(var(--bg-surface), var(--toast-accent), 5%);
    color: var(--text-main);

    &:hover {
      background: blend(var(--bg-surface), var(--toast-accent), 10%);
    }
  }
}

// ==========================================================================
// 3. ICONS & LOADER (Micro-Indicators)
// ==========================================================================

.toast-icon {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.1em; // Emojis look better slightly larger
  line-height: 1;
  width: 1.2em;
  height: 1.2em;

  // Ensure icons don't shrink if text is long
  flex-shrink: 0;
}

// The Quantum Spin Loader (Tiny & Precise)
.spin-loader {
  width: 1em;
  height: 1em;
  animation: rotate 1s linear infinite;
  background-color: unset;

  .track {
    fill: none;
    stroke: var(--text-mute);
    stroke-width: calc(var(--physics-border-width) * 2);
    opacity: 0.2;
  }

  .car {
    fill: none;
    stroke: var(--text-main);
    stroke-width: calc(var(--physics-border-width) * 2);
    stroke-dasharray: 10 20;
    stroke-linecap: round;
  }

  // Retro Loader Override
  @at-root [data-physics='retro'] & {
    animation-timing-function: steps(8);
  }
}

// ==========================================================================
// 4. CONTENT
// ==========================================================================
.toast-text {
  position: relative;
  z-index: 1;
  color: var(--text-main);
}
