/* Dialog and modal styling for native <dialog>. */

@use '../abstracts' as *;

dialog {
  // Layout and position.
  position: fixed;
  margin: auto; // Centers native dialogs
  padding: 0; // Reset, let inner container handle it
  inset: 0; // Ensure full screen centering context
  overscroll-behavior: contain; // Prevents scroll chaining to the body

  // Responsive width strategy.
  width: min(calc(100vw - var(--dialog-gutter)), var(--modal-width-sm));
  // Max height keeps header/footer visible on short screens.
  max-height: calc(100dvh - var(--dialog-gutter-lg));

  // Tablet+.
  @include respond-up('tablet') {
    width: min(calc(100vw - var(--dialog-gutter-lg)), var(--modal-width-md));
  }

  // Mini (alerts/confirm).
  &[data-size='sm'] {
    width: min(
      calc(100vw - var(--dialog-gutter)),
      24rem
    ); // Intentionally smaller than standard
    text-align: center; // Usually centered text for alerts
  }

  // Wide (complex layouts).
  &[data-size='lg'] {
    width: min(calc(100vw - var(--dialog-gutter)), var(--modal-width-lg));
    max-width: var(--modal-width-xl); // Ultrawide Cap
  }

  // Full (immersive).
  &[data-size='full'] {
    width: calc(100vw - var(--dialog-gutter));
    height: calc(100dvh - var(--dialog-gutter));
    max-height: none;
  }

  // Base styling.
  border: none;
  border-radius: calc(var(--radius-base) * 2);
  color: var(--text-main);

  // Modals float higher than cards.
  box-shadow: var(--shadow-lift);

  // Default (open) state.
  opacity: 1;
  transform: scale(1) translateY(0);
  filter: blur(0);

  // Apply glass physics (static).
  @include glass-float($interactive: false);

  // Progressive enhancement: only animate if display transitions are supported.
  @supports (transition-behavior: allow-discrete) {
    transition:
      opacity var(--speed-base) var(--ease-flow),
      transform var(--speed-base) var(--ease-snap),
      filter var(--speed-base) var(--ease-flow),
      display var(--speed-base) allow-discrete,
      overlay var(--speed-base) allow-discrete;

    @starting-style {
      opacity: 0;
      transform: scale(0.95) translateY(10px); // void-ignore (Motion Physics)
      filter: blur(var(--physics-blur));
    }

    // Exit state when [open] is removed.
    &:not([open]) {
      opacity: 0;
      transform: scale(0.95) translateY(-10px); // void-ignore (Motion Physics)
      filter: blur(var(--physics-blur));
    }
  }

  // Backdrop.
  &::backdrop {
    background: alpha(var(--bg-canvas), 80%);
    opacity: 0;

    // Light mode override.
    @at-root [data-mode='light'] & {
      background: rgba(0, 0, 0, 0.5);
    }

    @supports (transition-behavior: allow-discrete) {
      transition:
        opacity var(--speed-base) var(--ease-flow),
        display var(--speed-base) allow-discrete,
        overlay var(--speed-base) allow-discrete;
    }
  }

  // Backdrop only when dialog is open.
  &[open]::backdrop {
    opacity: 1;

    @starting-style {
      opacity: 0;
    }
  }

  // Inner content layout.
  & > div {
    display: flex;
    flex-flow: column nowrap;
    padding: var(--surface-padding);
    gap: var(--space-md);

    h2,
    h3 {
      color: var(--text-main);
      margin: 0;
      font-family: var(--font-heading);
    }

    p {
      color: var(--text-dim);
      line-height: 1.6;
    }
  }

  // Scrollbars.
  overflow-y: auto;
  @include laser-scrollbar;

  // Light mode override.
  @at-root [data-mode='light'] & {
    background: var(--bg-surface);
    border: var(--physics-border-width) solid var(--border-color);
    border-radius: var(--radius-base);

    &:not([open]) {
      opacity: 0;
      transform: scale(0.95);
      filter: none;
    }
  }
}
