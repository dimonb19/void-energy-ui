/* ==========================================================================
 * TILES
 * ==========================================================================
 *
 * Holographic data slates for collections and story cards.
 *
 * ARCHITECTURE:
 * - Section 1: Tiles & Collections
 *   - .tiles-collection : Horizontal scroll container
 *   - .tile             : Story card with image, gradient overlay, content
 *   - .tile-fluid       : Responsive tile that fills grid column
 *   - .loading-tile     : Skeleton loading state
 *
 * PHYSICS BEHAVIOR:
 * - Glass: Semi-transparent backgrounds, soft shadows, blur effects
 * - Flat:  Solid backgrounds, subtle shadows, no blur
 * - Retro: Hard borders, pixel shadows, instant state changes
 *
 * TILE ANATOMY:
 * - img        : Background image layer (absolute, full bleed)
 * - ::after    : Gradient overlay for text legibility
 * - h5         : Title text
 * - .tile-data : Metadata container (chips, stats, dates)
 *
 * USAGE:
 * ```html
 * <div class="tiles-collection">
 *   <a class="tile" href="/story/1">
 *     <img src="..." alt="Story thumbnail" />
 *     <h5>Story Title</h5>
 *     <div class="tile-data">
 *       <span>Author</span>
 *       <span>12 min read</span>
 *     </div>
 *   </a>
 * </div>
 * ```
 *
 * @see /CHEAT-SHEET.md for usage examples
 * @see _chips.scss for chip components (extracted to separate file)
 * ==========================================================================
 */

@use '../abstracts' as *;

// ==========================================================================
// 1. TILES & COLLECTIONS
// Holographic data slates for collections and story cards.
// ==========================================================================

// A. THE COLLECTION (Horizontal Scroll Container)
// --------------------------------------------------------------------------
.tiles-collection {
  width: 100%;
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: center;
  gap: var(--space-md);

  // Container-aligned padding with extra vertical breathing room.
  padding: var(--space-xs) var(--space-md) var(--space-lg) var(--space-md);

  overflow-x: auto;
  overflow-y: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;

  @include laser-scrollbar;
}

// B. THE STORY TILE (Holographic Slate)
// --------------------------------------------------------------------------
// NOTE: Width properties intentionally in SCSS (not Tailwind) because:
// - Widths scale with --density (physics concern, not pure layout)
// - Values depend on --unit CSS variable cascade
// - Responsive widths are physics-coupled, not arbitrary breakpoint styling
// --------------------------------------------------------------------------
.tile {
  position: relative;
  flex: none;
  aspect-ratio: 2 / 3;

  // Width scales with unit × density for compact modes.
  // void-hybrid-exception: density-coupled width
  //
  // TILE WIDTH PROGRESSION (2:3 aspect ratio targets):
  // ┌─────────────┬────────────┬─────────────┬──────────────┐
  // │ Breakpoint  │ Multiplier │ Base Width  │ Height (2:3) │
  // ├─────────────┼────────────┼─────────────┼──────────────┤
  // │ Mobile      │ 40 × 4px   │ 160px       │ 240px        │
  // │ Tablet      │ 56 × 4px   │ 224px       │ 336px        │
  // │ Desktop     │ 64 × 4px   │ 256px       │ 384px        │
  // │ Full HD     │ 72 × 4px   │ 288px       │ 432px        │
  // └─────────────┴────────────┴─────────────┴──────────────┘
  // Multipliers chosen to maintain readable title text at each breakpoint
  // while respecting the 2:3 portrait card ratio (standard book cover).
  width: calc(40 * var(--unit) * var(--density, 1));

  display: flex;
  flex-direction: column;
  justify-content: flex-end;

  // Physics base: mixin with custom background/padding.
  @include glass-float($interactive: true);
  padding: 0; // Images are full bleed
  background: var(--bg-sink); // Darker than standard cards

  text-decoration: none !important;
  overflow: hidden;
  border-radius: calc(var(--radius-base) * 1.5);
  border-width: var(--physics-border-width);

  // Unified Spring Transitions
  transition:
    transform var(--speed-base) var(--ease-spring-gentle),
    border-color var(--speed-base) var(--ease-spring-gentle),
    box-shadow var(--speed-base) var(--ease-spring-gentle);

  &.tile-fluid {
    width: 100%; // Takes the size of the grid column
    min-width: 0; // Prevents flex blowout
    aspect-ratio: 2 / 3; // Maintains the shape
  }

  // Image layer.
  img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: z('floor');
    transition: transform var(--speed-base) var(--ease-spring-gentle); // Smooth pan with spring.
  }

  // Gradient overlay anchors legibility.
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      transparent 40%,
      alpha(var(--bg-canvas), 40%) 60%,
      alpha(var(--bg-canvas), 90%) 80%,
      var(--bg-canvas) 100% // Solid floor.
    );
    z-index: z('base');
    pointer-events: none;
  }

  // Content.
  h5 {
    position: relative;
    z-index: z('decorate');
    margin: 0;
    padding: 0 var(--space-sm) var(--space-xs) var(--space-sm);

    font-family: var(--font-heading);
    color: var(--text-main);
    font-weight: var(--font-weight-bold);
    font-size: var(--font-size-h5);
    line-height: var(--line-height-title);

    @include when-light {
      text-shadow: none;
    }
  }

  .tile-data {
    position: relative;
    z-index: z('decorate');
    padding: 0 var(--space-sm) var(--space-sm) var(--space-sm);
    display: flex;
    flex-wrap: wrap;
    gap: var(--space-xs);

    p,
    span {
      font-size: var(--font-size-caption);
      color: var(--text-mute);
      transition: color var(--speed-base) var(--ease-spring-snappy);
    }
  }

  @media (hover: hover) {
    &:hover:not(.loading-tile),
    &:focus-visible:not(.loading-tile) {
      img {
        transform: scale(var(--scale));
      }

      .tile-data p {
        color: var(--text-main);
      }

      @include when-retro {
        border-color: var(--energy-primary);
      }
    }
  }

  // Responsive widths (void-hybrid-exception: density-coupled)
  @include respond-up('tablet') {
    width: calc(56 * var(--unit) * var(--density, 1));
  }
  @include respond-up('large-desktop') {
    width: calc(64 * var(--unit) * var(--density, 1));
  }
  @include respond-up('full-hd') {
    width: calc(72 * var(--unit) * var(--density, 1));
  }
}

// C. LOADING TILE (Skeleton)
// --------------------------------------------------------------------------
.loading-tile {
  @extend .tile;
  background: var(--bg-sink);
  pointer-events: none; // Non-interactive

  h5,
  .tile-data,
  img {
    opacity: 0;
  }

  &::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: z('float');

    @include shimmer;
  }
}
