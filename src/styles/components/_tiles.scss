@use '/src/styles/abstracts' as *;

// ==========================================================================
// TILES & COLLECTIONS
// Mantra: "Windows into Data."
// ==========================================================================

// 1. THE COLLECTION (Horizontal Scroll Container)
// --------------------------------------------------------------------------
.tiles-collection {
  width: 100%; 
  min-height: 18rem;
  display: flex;
  flex-flow: row nowrap;
  justify-content: flex-start;
  align-items: center;
  gap: 1.5rem;
  
  // Padding respects the container layout but adds vertical breathing room
  padding: 0.5rem 1.5rem 2rem 1.5rem;
    
  overflow-x: auto;
  overflow-y: hidden;
  scroll-behavior: smooth;
  -webkit-overflow-scrolling: touch;
  
  // --- DYNAMIC LASER SCROLLBARS ---
  scrollbar-width: thin;
  scrollbar-color: var(--energy-secondary) transparent;

  &::-webkit-scrollbar { 
    height: 4px; 
  }
  
  &::-webkit-scrollbar-track { 
    background: rgba(255, 255, 255, 0.02); 
    border-radius: 4px; 
    
    // Paper Override
    @at-root [data-atmosphere='paper'] & {
      background: rgba(0,0,0,0.05);
    }
  }
  
  &::-webkit-scrollbar-thumb { 
    background: linear-gradient(90deg, var(--energy-secondary), var(--energy-primary)); 
    border-radius: 4px;
    
    &:hover { 
      background: var(--energy-primary); 
      // Glow works in Void, becomes simple color in Paper
      box-shadow: 0 0 10px color-mix(in srgb, var(--energy-primary), transparent 40%);
    }
  }
}

// 2. THE STORY TILE (Holographic Slate)
// --------------------------------------------------------------------------
.tile {
  position: relative;
  flex: none;
  width: 10rem; // Mobile width
  aspect-ratio: 2 / 3;
    
  display: flex;
  flex-direction: column;
  justify-content: flex-end;
    
  // --- PHYSICS BASE ---
  // We use the mixin for borders/shadows, but override background/padding
  @include glass-float($interactive: true);
  padding: 0; // Images are full bleed
  background: var(--bg-sink); // Darker than standard cards
  
  text-decoration: none !important;
  overflow: hidden;
  border-radius: 12px; // Fixed visually pleasing radius
  border-width: 2px;
  
  // Explicit transition for hover effects
  transition: 
    transform var(--speed-base) var(--ease-stabilize), 
    border-color var(--speed-base) var(--ease-snap),
    box-shadow var(--speed-base) var(--ease-snap);

  // --- THE IMAGE ---
  img {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    z-index: z('floor');
    transition: transform var(--speed-base) var(--ease-stabilize); // Smooth pan effect
  }

  // --- THE ATMOSPHERIC GRADIENT (The "Scuba Dive") ---
  // This gradient ensures text is legible at the bottom.
  // It uses var(--bg-canvas) so it fades perfectly into Void, Crimson, or White.
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      to bottom,
      transparent 0%,
      transparent 40%,        // Keep top clear
      color-mix(in srgb, var(--bg-canvas), transparent 60%) 60%, 
      color-mix(in srgb, var(--bg-canvas), transparent 10%) 80%, 
      var(--bg-canvas) 100%   // Solid Floor
    );
    z-index: z('base');
    pointer-events: none;
  }

  // --- CONTENT LAYOUT ---

  h5 {
    position: relative;
    z-index: z('decorate');
    margin: 0;
    padding: 0 0.75rem 0.25rem 0.75rem;
    
    font-family: var(--font-heading);
    color: var(--text-main);
    font-weight: 700;
    font-size: 1rem;
    line-height: 1.2;
    
    // Text shadow for legibility over image
    text-shadow: 0 2px 4px rgba(0,0,0,0.9); 
    
    @at-root [data-atmosphere='paper'] & {
       // color: #FFFFFF; // Always white text over image, even in Paper mode
       // text-shadow: 0 2px 8px rgba(0,0,0,0.8);
       text-shadow: none;
    }
  }

  .tile-data {
    position: relative;
    z-index: z('decorate');
    padding: 0 0.75rem 0.75rem 0.75rem;
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    
    p, span {
      font-size: 0.75rem;
      color: var(--text-mute);
      transition: color 0.3s ease;
      
      @at-root [data-atmosphere='paper'] & {
         color: rgba(255,255,255,0.7); // Light grey on image
      }
    }
  }

  // --- INTERACTION ---
  @media (hover: hover) {
    &:hover:not(.loading-tile),
    &:focus-visible:not(.loading-tile) {
      // Logic handled by mixin, but we add image scale here
      img { transform: scale(1.05); }
      
      // Light up metadata
      .tile-data p { 
        color: var(--text-main); 
        @at-root [data-atmosphere='paper'] & { color: #FFFFFF; }
      } 

      @at-root [data-atmosphere='terminal'] & {
        img { transform: scale(1.01); }
      }
    }
  }

  // --- RESPONSIVE WIDTHS ---
  // Using standard breakpoints logic
  @media (min-width: 768px) { width: 14rem; }
  @media (min-width: 1440px) { width: 16rem; }
  @media (min-width: 1920px) { width: 18rem; } 
}

// 3. LOADING TILE (Skeleton)
// --------------------------------------------------------------------------
.loading-tile {
  @extend .tile; 
  background: var(--bg-sink);
  pointer-events: none; // Non-interactive
  
  // Clean slate for the skeleton
  h5, .tile-data, img { opacity: 0; } 
  
  &::before {
    content: '';
    position: absolute;
    inset: 0;
    z-index: z('float');

    // Apply the animation mixin
    @include shimmer;
  }
}

// ==========================================================================
// 4. SMALL TILES (Chips / Tags / Selection Items)
// ==========================================================================

.tile-small {
  // Layout
  display: inline-flex;
  flex-flow: row nowrap;
  align-items: center;
  justify-content: space-between;
  gap: 0.75rem;
  padding: 0.5rem 0.75rem;
  
  // Sizing
  width: 100%; // Default to full width on mobile
  @media (min-width: 768px) { width: auto; } // Shrink to fit on tablet+

  // Physics (Glass Base)
  @include glass-float($interactive: true);
  border-radius: 8px;
  background: var(--bg-surface);
  
  // Transition (Matching your legacy speed)
  transition: 
    all 0.3s var(--ease-snap);

  // Typography
  h5 {
    margin: 0;
    font-size: 0.875rem;
    font-weight: 600;
    white-space: nowrap;
    color: var(--text-main);
  }

  // Inner Content (The "p" tag in your legacy code)
  // We make this generic so it can be a <div>, <p>, or <span>
  & > .tile-content, 
  & > p {
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    background: color-mix(in srgb, var(--bg-canvas), transparent 50%);
    color: var(--text-dim);
    font-size: 0.75rem;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.3);
  }

  // ENTRY ANIMATION (@starting-style)
  @starting-style {
    opacity: 0;
    transform: scale(0.975) skew(1deg, -1deg); // Kept your specific skew!
    filter: brightness(125%) contrast(125%);
  }

  // HOVER STATES
  @media (hover: hover) {
    &:hover:not(:disabled) {
      transform: translateY(-2px) scale(1.02);
      filter: brightness(1.1);
      
      & > .tile-content, & > p {
        background: var(--bg-canvas);
        color: var(--text-main);
      }
    }
  }

  // DISABLED
  &:disabled {
    opacity: 0.5;
    filter: grayscale(1);
    cursor: not-allowed;
  }
}

// 5. COLOR VARIANTS (Semantic Mapping)
// --------------------------------------------------------------------------
// Usage: <div class="tile-small tile-purple">

@mixin tile-variant($color) {
  border-color: color-mix(in srgb, $color, transparent 50%);
  background: color-mix(in srgb, $color, transparent 90%);

  h5 { color: $color; }
  
  & > .tile-content, & > p {
    // Inner box is a darker version of the main color
    background: color-mix(in srgb, $color, black 40%); 
    color: color-mix(in srgb, $color, white 80%);
  }

  @media (hover: hover) {
    &:hover:not(:disabled) {
      border-color: $color;
      background: color-mix(in srgb, $color, transparent 80%);
      box-shadow: 0 4px 12px color-mix(in srgb, $color, transparent 30%);
    }
  }
}

.tile-system { @include tile-variant(var(--color-system)); }  // Maps to System (Purple)
.tile-premium { @include tile-variant(var(--color-premium)); } // Maps to Premium (Orange)
.tile-success  { @include tile-variant(var(--color-success)); } // Maps to Signal (Green)
.tile-error   { @include tile-variant(var(--color-error)); }   // Maps to Alert (Red/Rose)
.tile-secondary   { @include tile-variant(var(--energy-secondary)); } // Maps to Void Blue

// 6. THE ADDON (Label on Top)
// --------------------------------------------------------------------------
// Usage: <div class="tile-small tile-purple tile-labeled" data-label="Active">

.tile-labeled {
  position: relative;
  margin-top: 1rem; // Make room for the label
  border-top-left-radius: 0; // The "Tab" look

  &::before {
    content: attr(data-label);
    position: absolute;
    top: -1.25rem; // Move up
    left: -1px;    // Align with border
    
    // Style matches the border/bg of the tile
    height: 1.25rem;
    padding: 0 0.5rem;
    
    background: inherit;     // Steals background from parent
    border: inherit;         // Steals border from parent
    border-bottom: none;     // Connect to main tile
    border-top-left-radius: 8px;
    border-top-right-radius: 8px;
    
    font-size: 0.65rem;
    font-weight: 700;
    text-transform: uppercase;
    color: inherit;          // Steals text color from parent h5
    
    display: flex;
    align-items: center;
    z-index: 1;
  }
}