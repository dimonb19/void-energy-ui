/* Button system skin (base, CTA, semantic variants). */

@use '../abstracts' as *;

/* ==========================================================================
   BUTTON NOTES
   - Resting state carries potential energy through glass/border treatments.
   - Hover/Focus converts to kinetic energy via glow, lift, and brightness.
   - See global.scss SYSTEM NOTES for a compact API summary.
   ========================================================================== */

// ==========================================================================
// BUTTONS
// ==========================================================================

// 1. BASE BUTTON & VARIANTS
// --------------------------------------------------------------------------
// We define everything inside this block to ensure specificity works correctly.
button:not(.btn-void),
.btn {
  // --- A. Layout & Accessibility ---
  min-height: var(--control-height);
  min-width: var(--control-height);
  display: inline-flex;
  justify-content: center;
  align-items: center;
  gap: calc(var(--space-sm) - var(--space-xs) / 2);
  padding-block: 0;
  padding-inline: calc(var(--space-sm) + var(--space-xs) / 2);

  user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none; // Prevents iOS long-press context menu

  // --- B. Typography ---
  font-family: var(--font-body);
  font-weight: var(--font-weight-semibold);
  font-size: var(--font-size-small);
  letter-spacing: 0.05em;
  text-transform: uppercase;
  color: var(--text-main);
  text-decoration: none;
  line-height: 1;

  // --- C. The Physics (Glass) ---
  background: var(--bg-surface);

  // Borders rely on the physics engine variables
  border: var(--physics-border-width) solid var(--border-color);
  border-radius: var(--radius-base);

  // Transitions
  transition:
    color var(--speed-fast) var(--ease-flow),
    background-color var(--speed-fast) var(--ease-flow),
    border-color var(--speed-fast) var(--ease-snap),
    box-shadow var(--speed-fast) var(--ease-snap),
    transform var(--speed-fast) var(--ease-stabilize);

  cursor: pointer;
  position: relative;
  overflow: hidden;

  @at-root [data-mode='light'] & {
    background: blend(var(--bg-surface), var(--energy-primary), 5%);
  }

  // --- D. Interaction States ---

  &:focus-visible {
    outline: none;
    border-color: var(--energy-primary);
    box-shadow: var(--focus-ring);
  }

  @media (hover: hover) {
    &:hover:not(:disabled) {
      background: blend(var(--bg-surface), var(--energy-secondary), 8%);
      border-color: var(--energy-primary);
      transform: translateY(var(--lift)) scale(var(--scale, 1));
      color: var(--text-main);
      box-shadow: var(--shadow-lift);
    }
  }

  &:active:not(:disabled) {
    // Invert the scale for press-down effect (1.02 → 0.98, 1.01 → 0.99, 1 → 1)
    transform: scale(calc(2 - var(--scale, 1)));
    background: blend(var(--bg-surface), var(--energy-secondary), 12%);
    border-color: var(--energy-secondary);
  }

  &:disabled {
    background: alpha(var(--text-mute), 0.1);
    border-color: alpha(var(--text-mute), 0.25);
    color: var(--text-mute);
    cursor: not-allowed;
    box-shadow: none;
  }

  // ========================================================================
  // 2. THE GEMINI LASER (CTA)
  // Nested to override Base Styles properly
  // ========================================================================
  &.btn-cta:not(:disabled) {
    @include gemini-laser;

    color: var(--energy-primary);
    font-weight: 800;
    min-height: var(--space-xl);
    padding-inline: var(--space-md);

    border-radius: var(--radius-full);

    @media (hover: hover) {
      &:hover:not(:disabled) {
        // Reset base button hover effects that clash
        background: transparent;
        border: none;
        color: var(--text-main);
      }
    }
  }

  // ========================================================================
  // 3. SEMANTIC VARIANTS
  // Nested to override Base Styles properly
  // ========================================================================

  // Mixin for clean overrides
  @mixin btn-variant($color-var) {
    border-color: alpha($color-var, 50%);
    background: alpha($color-var, 10%);
    color: $color-var;

    @media (hover: hover) {
      &:hover:not(:disabled) {
        border-color: $color-var;
        background: alpha($color-var, 15%);
        color: var(--text-main);

        box-shadow: var(--shadow-lift);

        // Only apply colored glow if we are in Glass Physics
        @at-root [data-physics='glass'] & {
          box-shadow: 0 0 15px alpha($color-var, 40%); // void-ignore (Glow Physics)
          text-shadow: 0 0 10px alpha($color-var, 60%); // void-ignore (Glow Physics)
        }

        @at-root [data-mode='light'] & {
          color: $color-var; // Keep text readable in light mode
          text-shadow: none;
        }

        @at-root [data-physics='retro'] & {
          box-shadow: 3px 3px 0px alpha($color-var, 50%);
        }
      }
    }

    &:active:not(:disabled) {
      border-color: blend($color-var, var(--energy-secondary), 12%);
      background: alpha($color-var, 20%);
    }
  }

  &.btn-premium:not(:disabled) {
    @include btn-variant(var(--color-premium));
  }
  &.btn-system:not(:disabled) {
    @include btn-variant(var(--color-system));
  }
  &.btn-signal:not(:disabled) {
    @include btn-variant(var(--color-success));
  }
  &.btn-alert:not(:disabled) {
    @include btn-variant(var(--color-error));
  }

  // ========================================================================
  // ACTIVE STATE (Toggle / Selected)
  // Usage: <button class="btn" aria-pressed="true">
  // ========================================================================
  @include state-active {
    // 1. Solid Fill (The "Lit" Look)
    background: alpha(var(--energy-primary), 15%);
    border-color: var(--energy-primary);

    // 2. Contrast Text
    color: var(--text-main);

    // 3. Glow Effect
    box-shadow: var(--shadow-lift);

    // --- MODE EXCEPTIONS ---
    @at-root [data-mode='light'] & {
      background: alpha(var(--energy-primary), 10%);
      color: var(--energy-primary);
    }

    @at-root [data-physics='retro'] & {
      background: alpha(var(--color-success), 20%);
    }
  }
}

// 4. UTILITIES
// --------------------------------------------------------------------------

// Naked Reset (Use this class to opt-out of the block above)
.btn-void {
  appearance: none;
  background: transparent;
  border: none;
  padding: 0;
  margin: 0;
  cursor: pointer;
  color: inherit;
  font: inherit;
  min-width: unset;
  min-height: unset;
  display: inline-flex;
}

// Icon Button
.btn-icon {
  padding: 0;
  width: var(--control-height);
  height: var(--control-height);
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}
