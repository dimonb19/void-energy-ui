/* Physics mixins for surfaces, text effects, and utilities. */

@use 'variables' as *;
@use 'functions' as *;

// ==========================================================================
// 1. SURFACES
// ==========================================================================

// MIXIN: Floating Surface (Cards, Modals)
// Context: Positive Z-Index. Floats above the void.
// $interactive: boolean - Set to true ONLY if the element is clickable (Link/Button)
@mixin glass-float($interactive: false) {
  // Texture and geometry.
  background: var(--surface-bg);
  border-radius: var(--radius-base);
  border-style: solid;
  border-width: var(--physics-border-width);

  // Lighting.
  border-color: var(--surface-border);

  // Shadow switches by physics preset.
  box-shadow: var(--shadow-float);

  // Unified Spring Motion
  // All properties use the same spring for cohesive "object" feel
  transition:
    transform var(--speed-base) var(--ease-spring-gentle),
    border-color var(--speed-base) var(--ease-spring-gentle),
    background-color var(--speed-base) var(--ease-spring-gentle),
    box-shadow var(--speed-base) var(--ease-spring-gentle);

  // Blur.
  @supports (backdrop-filter: blur(1px)) {
    backdrop-filter: blur(var(--physics-blur));
    -webkit-backdrop-filter: blur(var(--physics-blur));
  }

  // Interaction.
  @media (hover: hover) {
    &:hover {
      @if $interactive {
        transform: translateY(var(--lift));
        border-color: var(--energy-primary);
        box-shadow: var(--shadow-lift);
      }
    }
  }
}

// MIXIN: Sunk Surface (Inputs, Sidebars)
// Context: Negative Z-Index. Carved into the void.
@mixin glass-sunk {
  background: var(--bg-sink);

  border: var(--physics-border-width) solid var(--border-color);
  border-radius: var(--radius-base);
  color: var(--text-main);

  // Unified depth.
  box-shadow: var(--shadow-sunk);

  // Unified Spring Transitions
  transition:
    border-color var(--speed-fast) var(--ease-spring-snappy),
    box-shadow var(--speed-fast) var(--ease-spring-snappy),
    outline var(--speed-fast) var(--ease-spring-snappy);

  @supports (backdrop-filter: blur(1px)) {
    backdrop-filter: blur(var(--physics-blur));
    -webkit-backdrop-filter: blur(var(--physics-blur));
  }

  &:focus-visible {
    border-color: var(--energy-primary);
    box-shadow: var(--focus-ring);
  }
}

// ==========================================================================
// 2. TYPOGRAPHY & ENERGY
// ==========================================================================

@mixin gemini-laser {
  position: relative;
  isolation: isolate; // Force stacking context on the button itself.
  background: transparent;
  border: none;
  overflow: hidden;
  z-index: z('base');
  color: var(--text-main);

  // Parent radius clips the beam and keeps the gradient contained.
  border-radius: var(--radius-full);

  // Rotating beam.
  &::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    width: 500%;
    height: 500%;
    border-radius: 50%;

    // Tail gradient.
    background: conic-gradient(
      from 0deg,
      transparent 0deg,
      var(--energy-secondary) 100deg,
      var(--energy-primary) 160deg,
      var(--energy-primary) 200deg,
      var(--energy-secondary) 260deg,
      transparent 360deg
    );

    transition: background-color var(--speed-base) var(--ease-spring-gentle);

    will-change: transform;
    transform: translate(-50%, -50%);
    animation: rotate-laser 4s linear infinite;
    z-index: -2;

    // Retro override: segmented sweep.
    @at-root :where([data-physics='retro']) & {
      background: conic-gradient(
        from 0deg,
        transparent 0deg,
        transparent 100deg,
        var(--energy-primary) 100deg,
        var(--energy-primary) 115deg,
        transparent 115deg,
        transparent 125deg,
        var(--energy-primary) 125deg,
        var(--energy-primary) 150deg,
        transparent 150deg,
        transparent 160deg,
        var(--energy-primary) 160deg,
        var(--energy-primary) 240deg,
        transparent 240deg,
        transparent 360deg
      );
      animation-timing-function: steps(64);
    }
  }

  // Inner mask.
  &::after {
    content: '';
    position: absolute;
    inset: var(--physics-border-width);

    background: var(--bg-canvas);

    z-index: -1;
    border-radius: var(--radius-full);
  }

  // Hover surge.
  @media (hover: hover) {
    &:hover::before {
      background-color: var(--energy-primary);
      animation-play-state: paused;
    }

    &:hover::after {
      background: blend(var(--bg-canvas), var(--energy-primary), 6%);
    }
  }
}

// ==========================================================================
// 3. ANIMATIONS
// ==========================================================================

// MIXIN: Atmospheric Shimmer
// Usage: Include in any element that acts as a loading skeleton.
@mixin shimmer {
  background-size: 400% 100%;

  animation: shimmer 3s infinite linear;

  // Default Void gradient.
  background-image: linear-gradient(
    90deg,
    transparent 0%,
    transparent 30%,
    alpha(var(--energy-primary), 15%) 50%,
    transparent 70%,
    transparent 100%
  );

  // Light mode override.
  @at-root :where([data-mode='light']) & {
    background-image: linear-gradient(
      90deg,
      transparent 0%,
      transparent 30%,
      rgba(255, 255, 255, 0.6) 50%,
      transparent 70%,
      transparent 100%
    );
  }

  // Retro override.
  @at-root :where([data-physics='retro']) & {
    opacity: 0.5;
    background-image: linear-gradient(
      90deg,
      transparent 0%,
      transparent 43%,
      var(--energy-primary) 43%,
      var(--energy-primary) 47%,
      transparent 47%,
      transparent 100%
    );
  }
}

// ==========================================================================
// 4. FOCUS STATE (Universal)
// ==========================================================================

// Universal Focus State Mixin
// Ensures consistent focus styling across ALL interactive elements.
// Apple's Rule: Focus states must be visually consistent for muscle memory.
//
// @param $include-sunk - Set true for inputs/textareas that have inset shadow
// @param $is-inline - Set true for inline elements (links) that shouldn't have ring
@mixin focus-state($include-sunk: false, $is-inline: false) {
  outline: none;

  @if $is-inline {
    // Inline elements (links): Use underline + subtle glow instead of ring
    text-decoration: underline;
    text-decoration-color: var(--energy-primary);
    text-underline-offset: 3px;

    @at-root [data-physics='glass'] & {
      text-shadow: 0 0 8px alpha(var(--energy-primary), 50%);
    }
  } @else {
    // Block elements (buttons, inputs): Use focus ring
    border-color: var(--energy-primary);

    @if $include-sunk {
      box-shadow: var(--shadow-sunk), var(--focus-ring);
    } @else {
      box-shadow: var(--focus-ring);
    }
  }

  // Spring transition for focus (instant feedback)
  transition:
    border-color var(--speed-instant) var(--ease-spring-snappy),
    box-shadow var(--speed-instant) var(--ease-spring-snappy),
    text-shadow var(--speed-instant) var(--ease-spring-snappy);
}

// ==========================================================================
// 5. STATE MANAGEMENT MIXINS (Strict Protocol)
// ==========================================================================

// A. ACTIVE STATE (Interactive)
// Use for: Toggles, Tabs, Selections.
// ⛔️ DO NOT USE: .active class
@mixin state-active {
  &[aria-pressed='true'],
  &[aria-selected='true'],
  &[aria-checked='true'],
  &[data-state='active'] {
    @content;
  }
}

// B. OPEN STATE (Visibility)
// Use for: Dropdowns, Tooltips, Dialogs, Accordions.
// ⛔️ DO NOT USE: .show, .open classes
@mixin state-open {
  &[data-state='open'],
  &[open] {
    @content;
  }
}

// C. LOADING STATE (Process)
// Use for: Buttons, Cards, inputs waiting for network.
// ⛔️ DO NOT USE: .loading class
@mixin state-loading {
  &[aria-busy='true'],
  &[data-status='loading'] {
    @content;
  }
}

// ==========================================================================
// 6. SCROLLBAR
// ==========================================================================

@mixin laser-scrollbar() {
  scrollbar-width: thin;
  scrollbar-color: var(--energy-secondary) var(--bg-sink);

  &::-webkit-scrollbar {
    width: var(--scrollbar-width);
    height: var(--scrollbar-width);
  }

  &::-webkit-scrollbar-track {
    background: var(--bg-sink);
    border-radius: var(--radius-full);
  }

  &::-webkit-scrollbar-thumb {
    background: var(--energy-secondary);
    border-radius: var(--radius-full);

    &:hover {
      background: var(--energy-primary);
    }
  }
}

// ==========================================================================
// 7. TEXT UTILITIES
// ==========================================================================

// MIXIN: Truncate
// Usage: @include text-truncate(1) for single line
// Usage: @include text-truncate(3) for multi-line narrative
@mixin text-truncate($lines: 1) {
  overflow: hidden;
  text-overflow: ellipsis;

  @if $lines == 1 {
    white-space: nowrap;
  } @else {
    display: -webkit-box;
    -webkit-line-clamp: $lines;
    line-clamp: $lines;
    -webkit-box-orient: vertical;
    white-space: normal;
  }
}

// MIXIN: Force wrap
// Usage: For API keys, hashes, or user-generated "gibberish"
@mixin text-wrap-force {
  overflow-wrap: anywhere;

  word-break: break-word;
}
